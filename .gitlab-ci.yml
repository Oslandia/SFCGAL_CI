coverage:
  image: debian:testing

  script:
    - apt-get update -qq
    - apt-get install --yes sudo wget build-essential gcovr
    - ./ci/debian/before_install.sh 5.3
    - cd $CI_PROJECT_DIR
    - CGAL_DIR=$CI_PROJECT_DIR/CGAL cmake -DSFCGAL_BUILD_TESTS=ON -DCMAKE_C_COMPILER=/usr/bin/gcc -DCMAKE_CXX_COMPILER=/usr/bin/g++
    - make
    - ctest -VV
    - gcovr --xml-pretty --exclude-unreachable-branches --print-summary -o coverage.xml --root ${CI_PROJECT_DIR}  --exclude-directories 'build/'  --exclude-directories 'test/'  --exclude-directories 'CGAL*' --filter src/
  coverage: '/^\s*lines:\s*\d+.\d+\%/'
  artifacts:
    name: ${CI_JOB_NAME}-${CI_COMMIT_REF_NAME}-${CI_COMMIT_SHA}
    expire_in: 2 days
    reports:
      cobertura: build/coverage.xml
