.debian_test_base:
  stage: test
  rules:
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: always
  parallel:
    matrix:
      - CGAL_VERSION: ["5.6.2", "6.0.1"]

debian_testing_gcc:
  extends: .debian_test_base
  image: debian:testing

  script:
    - apt-get update -qq
    - apt-get install --yes sudo wget build-essential
    - ./ci/debian/before_install.sh $CGAL_VERSION
    - cd $CI_PROJECT_DIR
    - CGAL_DIR=$CI_PROJECT_DIR/CGAL cmake -DSFCGAL_BUILD_TESTS=ON -DCMAKE_C_COMPILER=/usr/bin/gcc -DCMAKE_CXX_COMPILER=/usr/bin/g++
    - make -j$(nproc)
    - ctest -VV

debian_stable_gcc:
  extends: .debian_test_base
  image: debian:stable

  script:
    - apt-get update -qq
    - apt-get install --yes sudo wget build-essential
    - ./ci/debian/before_install.sh $CGAL_VERSION
    - cd $CI_PROJECT_DIR
    - CGAL_DIR=$CI_PROJECT_DIR/CGAL cmake -DSFCGAL_BUILD_TESTS=ON -DCMAKE_C_COMPILER=/usr/bin/gcc -DCMAKE_CXX_COMPILER=/usr/bin/g++
    - make -j$(nproc)
    - ctest -VV

debian_testing_clang:
  extends: .debian_test_base
  image: debian:testing

  script:
    - apt-get update -qq
    - apt-get install --yes sudo wget clang
    - ./ci/debian/before_install.sh $CGAL_VERSION
    - cd $CI_PROJECT_DIR
    - CGAL_DIR=$CI_PROJECT_DIR/CGAL cmake -DSFCGAL_BUILD_TESTS=ON -DCMAKE_C_COMPILER=/usr/bin/clang -DCMAKE_CXX_COMPILER=/usr/bin/clang++
    - make -j$(nproc)
    - ctest -VV

debian_stable_clang:
  extends: .debian_test_base
  image: debian:stable

  script:
    - apt-get update -qq
    - apt-get install --yes sudo wget clang
    - ./ci/debian/before_install.sh $CGAL_VERSION
    - cd $CI_PROJECT_DIR
    - CGAL_DIR=$CI_PROJECT_DIR/CGAL cmake -DSFCGAL_BUILD_TESTS=ON -DCMAKE_C_COMPILER=/usr/bin/clang -DCMAKE_CXX_COMPILER=/usr/bin/clang++
    - make -j$(nproc)
    - ctest -VV
