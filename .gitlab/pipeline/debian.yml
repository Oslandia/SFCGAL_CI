.debian_test_base:
  stage: plateform-build-test
  variables:
    OS_VERSION: "--"
    PACKAGE: "--"
    C_COMPILER: "--"
    CXX_COMPILER: "--"
  image: debian:${OS_VERSION}
  rules:
    # on default branch
    - if: $CI_COMMIT_BRANCH == $CI_DEFAULT_BRANCH
      when: always
    - if: $CI_PIPELINE_SOURCE == "merge_request_event"
      when: manual
  script:
    - apt-get update -qq
    - apt-get install --yes sudo wget ${PACKAGE}
    - ./ci/debian/before_install.sh $CGAL_VERSION
    - cd $CI_PROJECT_DIR
    - cmake -DSFCGAL_BUILD_TESTS=ON -DCMAKE_C_COMPILER=/usr/bin/${C_COMPILER} -DCMAKE_CXX_COMPILER=/usr/bin/${CXX_COMPILER} -DCGAL_DIR=${CI_PROJECT_DIR}/CGAL-${CGAL_VERSION}
    - make -j$(nproc)
    - ctest -VV
  parallel:
    matrix:
      - CGAL_VERSION: [$CGAL_5_VERSION, $CGAL_LATEST_VERSION, 6.1-beta1]
        OS_VERSION: ["stable", "testing"]

debian_clang:
  extends: .debian_test_base
  variables:
    PACKAGE: "clang"
    C_COMPILER: "clang"
    CXX_COMPILER: "clang++"

debian_gcc:
  extends: .debian_test_base
  variables:
    PACKAGE: "build-essential"
    C_COMPILER: "gcc"
    CXX_COMPILER: "g++"
